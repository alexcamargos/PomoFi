<div class="tasks-container">
    <div class="tasks-header" cdkDragHandle>
        <div class="title">
            <span class="material-symbols-rounded">check_circle</span>
            <span>Tasks</span>
        </div>
        <div class="window-controls">
            <button class="control-btn small">
                <span class="material-symbols-rounded">more_horiz</span>
            </button>
        </div>
    </div>

    <div class="tasks-list">
        <div *ngFor="let task of tasks; let i = index" class="task-item" [class.completed]="task.status === 'completed'"
            [class.separator-top]="task.status === 'completed' && (i === 0 || tasks[i-1].status !== 'completed')">
            <div class="task-info">
                <div class="task-title">{{ task.title }}</div>
                <div class="task-meta">
                    <span class="category-badge" *ngIf="task.category">{{ task.category }}</span>
                    <span class="pomodoros">{{ task.pomodoros }} <span
                            class="material-symbols-rounded">timer</span></span>
                </div>
            </div>
            <div class="task-actions">
                <button class="action-btn" (click)="toggleStatus(task)"
                    title="{{ task.status === 'completed' ? 'Mark as Pending' : 'Mark as Completed' }}">
                    <span class="material-symbols-rounded">{{ task.status === 'completed' ? 'check_circle' :
                        'radio_button_unchecked' }}</span>
                </button>
                <button class="action-btn" *ngIf="task.status !== 'completed'" (click)="editTask(task)" title="Edit">
                    <span class="material-symbols-rounded">edit</span>
                </button>
                <button class="action-btn delete" (click)="deleteTask(task.id)" title="Delete">
                    <span class="material-symbols-rounded">delete</span>
                </button>
            </div>
        </div>
    </div>

    <div class="add-task-form">
        <input type="text" [(ngModel)]="newTaskTitle" placeholder="New Task Title" class="task-input">

        <div class="form-row">
            <input type="number" [(ngModel)]="newTaskPomodoros" min="1" class="pomodoro-input" title="Pomodoros">
            <select [(ngModel)]="newTaskType" class="type-select" title="Type">
                <option value="Pomodoro 25">Pomodoro 25</option>
                <option value="Pomodoro 40">Pomodoro 40</option>
                <option value="Pomodoro 55">Pomodoro 55</option>
            </select>
        </div>

        <div class="form-row">
            <select [(ngModel)]="newTaskCategory" class="type-select" title="Category">
                <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>
            <button (click)="saveTask()" class="add-btn" title="{{ editingTask ? 'Save Task' : 'Add Task' }}">
                <span class="material-symbols-rounded">{{ editingTask ? 'save' : 'add' }}</span>
            </button>
            <button *ngIf="editingTask" (click)="cancelEdit()" class="add-btn cancel-btn" title="Cancel Edit">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>
    </div>
</div>